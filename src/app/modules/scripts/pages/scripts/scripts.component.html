<h1 class="component-h1 primary-color">Scripts</h1>

<mat-card class="mb-4" *ngIf="isLoading || isLoadingExecute">
  <mat-spinner class="mx-auto"></mat-spinner>
</mat-card>

<div class="mb-4" *ngIf="success" class="alert alert-success" role="alert">
  Executed!
</div>

<div class="mb-4" *ngIf="error" class="alert alert-danger" role="alert">
  Error!
</div>

<mat-card *ngIf="!isLoading">
  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <ng-container formArrayName="scripts">
        <div class="script-wrap" *ngFor="let scriptFc of form.get('scripts')['controls']; index as i;">
          <ng-container [formGroupName]="i">
            <div class="d-flex">
              <mat-form-field>
                <mat-label>Select script</mat-label>
                <mat-select formControlName="name" (selectionChange)="scriptSelected($event, i)">
                  <mat-option *ngFor="let script of scripts" [value]="script.name">
                    {{script.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <div *ngIf="form.get('scripts')['controls'].length > 1">
                <div (click)="removeScript(i)" class="lh-1 text-danger cursor-pointer p-1 ml-4"><b>X</b></div>
              </div>
            </div>
            <br>
            <ng-container formArrayName="options">
              <ng-container *ngIf="scriptFc.get('options')['controls'].length > 0">
                <div class="mb-1">Options</div>
                <ng-container *ngFor="let option of scriptFc.get('options')['controls']; index as j;">
                  <ng-container [formGroupName]="j">
                    <mat-checkbox formControlName="value" class="mr-4" color="primary">{{option.get('label').value}}</mat-checkbox>
                  </ng-container>
                </ng-container>
              </ng-container>

              <ng-container *ngIf="scriptFc.get('options')['controls'].length == 0 && scriptFc.get('name').value !== null">
                No options available.
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
      </ng-container>
      <div class="pt-4">
        <button mat-raised-button class="bg-success text-white" type="button" (click)="addScript()">Add</button>
      </div>
      <div class="pt-4">
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Execute</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
